<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n Tr·ªã Vi√™n - Pet House</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f6f9; }
        
        /* SIDEBAR */
        .sidebar { height: 100vh; width: 250px; position: fixed; top: 0; left: 0; background-color: #343a40; padding-top: 20px; color: white; z-index: 1000; }
        .sidebar .nav-link { padding: 15px 25px; font-size: 1rem; color: #cfd8dc; cursor: pointer; transition: 0.3s; border-radius: 0; display: block; width: 100%; text-align: left; background: none; border: none; }
        .sidebar .nav-link:hover { background-color: #495057; color: white; }
        .sidebar .nav-link.active { background-color: #0d6efd; color: white; border-right: 4px solid #fff; }
        .brand { text-align: center; font-size: 1.5rem; font-weight: bold; margin-bottom: 30px; color: #ffc107; text-transform: uppercase; }
        
        /* MAIN CONTENT */
        .main-content { margin-left: 250px; padding: 30px; }
        
        /* HI·ªÜU ·ª®NG CHUY·ªÇN TAB */
        .tab-section { display: none; } 
        .tab-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS & TABLES */
        .stat-card { border: none; border-radius: 15px; padding: 25px; color: white; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .bg-gradient-primary { background: linear-gradient(45deg, #4e73df, #224abe); }
        .bg-gradient-success { background: linear-gradient(45deg, #1cc88a, #13855c); }
        .bg-gradient-warning { background: linear-gradient(45deg, #f6c23e, #dda20a); }
        .table img { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; }

        /* BADGES TR·∫†NG TH√ÅI */
        .status-pending { background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; }
        .status-shipping { background: #cce5ff; color: #004085; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; }
        .status-done { background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; }
        .status-cancel { background: #f8d7da; color: #721c24; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; }

        /* PAGINATION */
        #pagination button { background: white; border: 1px solid #dee2e6; color: #0d6efd; padding: 5px 12px; margin: 0 2px; border-radius: 4px; }
        #pagination button.active { background: #0d6efd; color: white; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand"><i class="fas fa-paw"></i> Pet Admin</div>
        <div class="nav flex-column">
            <button class="nav-link active" onclick="switchTab(event, 'dashboard-tab'); loadDashboard()">
                <i class="fas fa-chart-line me-2"></i> T·ªïng quan
            </button>
            <button class="nav-link" onclick="switchTab(event, 'products-tab'); loadProducts()">
                <i class="fas fa-box-open me-2"></i> Kho H√†ng
            </button>
            <button class="nav-link" onclick="switchTab(event, 'orders-tab'); loadOrders()">
                <i class="fas fa-shopping-cart me-2"></i> ƒê∆°n H√†ng
            </button>
            <a href="index.html" class="nav-link text-warning mt-5">
                <i class="fas fa-external-link-alt me-2"></i> Xem Web Ch√≠nh
            </a>
            <button class="nav-link text-danger" onclick="resetSystem()">
                <i class="fas fa-trash-restore me-2"></i> Reset D·ªØ Li·ªáu Demo
            </button>
        </div>
    </div>

    <div class="main-content">
        
        <div id="dashboard-tab" class="tab-section active">
            <h3 class="mb-4 fw-bold">üìä T·ªïng quan kinh doanh</h3>
            <div class="row g-4 mb-5">
                <div class="col-md-4"><div class="stat-card bg-gradient-success"><div><h6>DOANH THU</h6><h2 class="fw-bold mb-0" id="stat-revenue">0ƒë</h2></div><i class="fas fa-wallet fa-3x opacity-50"></i></div></div>
                <div class="col-md-4"><div class="stat-card bg-gradient-primary"><div><h6>T·ªîNG ƒê∆†N</h6><h2 class="fw-bold mb-0" id="stat-orders">0</h2></div><i class="fas fa-shopping-bag fa-3x opacity-50"></i></div></div>
                <div class="col-md-4"><div class="stat-card bg-gradient-warning"><div><h6>S·∫¢N PH·∫®M</h6><h2 class="fw-bold mb-0" id="stat-products">0</h2></div><i class="fas fa-cubes fa-3x opacity-50"></i></div></div>
            </div>
            <h5>ƒê∆°n h√†ng m·ªõi nh·∫•t</h5>
            <div class="card p-3 shadow-sm">
                <table class="table align-middle"><thead class="table-light"><tr><th>M√£</th><th>Kh√°ch</th><th>T·ªïng</th><th>Tr·∫°ng th√°i</th></tr></thead><tbody id="recent-orders-body"></tbody></table>
            </div>
        </div>

        <div id="products-tab" class="tab-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">üì¶ Kho h√†ng</h3>
                <button class="btn btn-primary" onclick="openAddModal()"><i class="fas fa-plus-circle"></i> Th√™m m√≥n m·ªõi</button>
            </div>
            <div class="card p-4 shadow-sm">
                <table class="table table-hover align-middle">
                    <thead class="table-dark"><tr><th>·∫¢nh</th><th>T√™n s·∫£n ph·∫©m</th><th>Gi√°</th><th>Danh m·ª•c</th><th>H√†nh ƒë·ªông</th></tr></thead>
                    <tbody id="product-list"></tbody>
                </table>
                <div id="pagination" class="d-flex justify-content-center mt-3"></div>
            </div>
        </div>

        <div id="orders-tab" class="tab-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">üìã Danh s√°ch ƒë∆°n h√†ng</h3>
                <button class="btn btn-sm btn-danger" onclick="clearOrders()"><i class="fas fa-trash"></i> X√≥a t·∫•t c·∫£ ƒë∆°n</button>
            </div>
            
            <div class="card p-3 shadow-sm">
                <table class="table table-hover align-middle">
                    <thead class="bg-light"><tr><th>M√£</th><th>Kh√°ch</th><th>Chi ti·∫øt</th><th>T·ªïng ti·ªÅn</th><th>Tr·∫°ng th√°i</th><th>Thao t√°c</th></tr></thead>
                    <tbody id="order-table-body"></tbody>
                </table>
                <div id="empty-order-msg" class="text-center text-muted p-3 d-none">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o!</div>
            </div>
        </div>

    </div>

    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white"><h5 class="modal-title" id="modalTitle">S·∫£n ph·∫©m</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="p-id">
                        <div class="mb-3">
                            <label class="form-label">T√™n s·∫£n ph·∫©m</label>
                            <input type="text" class="form-control" id="p-name" required placeholder="Nh·∫≠p t√™n m√≥n h√†ng...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Gi√° (VNƒê)</label>
                            <input type="number" class="form-control" id="p-price" required placeholder="Nh·∫≠p s·ªë ti·ªÅn...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Link ·∫¢nh</label>
                            <input type="text" class="form-control" id="p-image" required placeholder="D√°n link ·∫£nh v√†o ƒë√¢y...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Danh m·ª•c</label>
                            <select class="form-select" id="p-category">
                                <option value="Th·ª©c ƒÉn">Th·ª©c ƒÉn</option>
                                <option value="Ph·ª• ki·ªán">Ph·ª• ki·ªán</option>
                                <option value="V·ªá sinh">V·ªá sinh</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 fw-bold" id="btnSave">L∆ØU S·∫¢N PH·∫®M</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- C·∫§U H√åNH H·ªÜ TH·ªêNG (LOCAL STORAGE) ---
        // Ch√∫ng ta kh√¥ng d√πng API n·ªØa m√† d√πng b·ªô nh·ªõ tr√¨nh duy·ªát ƒë·ªÉ Demo m∆∞·ª£t m√†
        
        // D·ªØ li·ªáu m·∫´u ban ƒë·∫ßu n·∫øu kho h√†ng tr·ªëng
        const INITIAL_PRODUCTS = [
            { id: 'sp1', name: 'Th·ª©c ƒÉn h·∫°t Royal Canin', price: 150000, category: 'Th·ª©c ƒÉn', image: 'https://cdn.pixabay.com/photo/2020/06/02/06/52/cat-food-5249714_1280.jpg' },
            { id: 'sp2', name: 'V√≤ng c·ªï l·ª•c l·∫°c', price: 50000, category: 'Ph·ª• ki·ªán', image: 'https://cdn.pixabay.com/photo/2014/04/05/11/40/dog-316598_1280.jpg' },
            { id: 'sp3', name: 'C√°t v·ªá sinh Nh·∫≠t B·∫£n', price: 120000, category: 'V·ªá sinh', image: 'https://bizweb.dktcdn.net/thumb/1024x1024/100/393/819/products/cat-nhat-den-8l-ve-sinh-cho-meo.jpg' },
            { id: 'sp4', name: 'Pate Whiskas', price: 35000, category: 'Th·ª©c ƒÉn', image: 'https://bizweb.dktcdn.net/100/414/018/products/pate-whiskas-cho-meo-lon-vi-ca-ngu-85g.jpg' }
        ];

        let productModalBox;

        document.addEventListener('DOMContentLoaded', () => {
            productModalBox = new bootstrap.Modal(document.getElementById('productModal'));
            
            // Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u n·∫øu ch∆∞a c√≥
            if (!localStorage.getItem('adminProducts')) {
                localStorage.setItem('adminProducts', JSON.stringify(INITIAL_PRODUCTS));
            }

            loadDashboard(); // M·∫∑c ƒë·ªãnh t·∫£i dashboard
        });

        // 1. CHUY·ªÇN TAB
        function switchTab(event, tabId) {
            document.querySelectorAll('.tab-section').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.sidebar .nav-link').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // 2. QU·∫¢N L√ù S·∫¢N PH·∫®M (KHO H√ÄNG)
        function loadProducts() {
            const products = JSON.parse(localStorage.getItem('adminProducts')) || [];
            const tbody = document.getElementById('product-list');
            tbody.innerHTML = '';

            // Ph√¢n trang ƒë∆°n gi·∫£n (Hi·ªán t·∫•t c·∫£ cho demo d·ªÖ)
            products.forEach(p => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${p.image}" onerror="this.src='https://via.placeholder.com/50'"></td>
                    <td><b>${p.name}</b></td>
                    <td class="text-danger fw-bold">${Number(p.price).toLocaleString()}ƒë</td>
                    <td><span class="badge bg-info text-dark">${p.category}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="openEditModal('${p.id}')"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${p.id}')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            document.getElementById('stat-products').innerText = products.length;
        }

        // M·ªü Modal Th√™m
        function openAddModal() {
            document.getElementById('productForm').reset();
            document.getElementById('p-id').value = '';
            document.getElementById('modalTitle').innerText = "Th√™m M·ªõi";
            document.getElementById('btnSave').innerText = "L∆ØU S·∫¢N PH·∫®M";
            document.getElementById('btnSave').className = "btn btn-primary w-100 fw-bold";
            productModalBox.show();
        }

        // M·ªü Modal S·ª≠a
        function openEditModal(id) {
            const products = JSON.parse(localStorage.getItem('adminProducts')) || [];
            const p = products.find(x => x.id === id);
            if(p) {
                document.getElementById('p-id').value = p.id;
                document.getElementById('p-name').value = p.name;
                document.getElementById('p-price').value = p.price;
                document.getElementById('p-image').value = p.image;
                document.getElementById('p-category').value = p.category;

                document.getElementById('modalTitle').innerText = "S·ª≠a S·∫£n Ph·∫©m";
                document.getElementById('btnSave').innerText = "C·∫¨P NH·∫¨T";
                document.getElementById('btnSave').className = "btn btn-warning w-100 fw-bold";
                productModalBox.show();
            }
        }

        // L∆∞u s·∫£n ph·∫©m (Th√™m ho·∫∑c S·ª≠a)
        document.getElementById('productForm').addEventListener('submit', (e) => {
            e.preventDefault();
            let products = JSON.parse(localStorage.getItem('adminProducts')) || [];
            const id = document.getElementById('p-id').value;
            
            const newProduct = {
                id: id || 'sp' + Date.now(), // N·∫øu kh√¥ng c√≥ ID th√¨ t·∫°o m·ªõi
                name: document.getElementById('p-name').value,
                price: Number(document.getElementById('p-price').value),
                image: document.getElementById('p-image').value,
                category: document.getElementById('p-category').value
            };

            if(id) {
                // S·ª≠a
                const index = products.findIndex(p => p.id === id);
                if(index !== -1) products[index] = newProduct;
            } else {
                // Th√™m m·ªõi
                products.push(newProduct);
            }

            localStorage.setItem('adminProducts', JSON.stringify(products));
            productModalBox.hide();
            loadProducts();
            alert("ƒê√£ l∆∞u th√†nh c√¥ng!");
        });

        // X√≥a s·∫£n ph·∫©m
        function deleteProduct(id) {
            if(confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a?")) { 
                let products = JSON.parse(localStorage.getItem('adminProducts')) || [];
                products = products.filter(p => p.id !== id);
                localStorage.setItem('adminProducts', JSON.stringify(products));
                loadProducts();
            }
        }

        // 3. QU·∫¢N L√ù ƒê∆†N H√ÄNG (K·∫øt n·ªëi v·ªõi Cart.html)
        function loadOrders() {
            // L·∫§Y D·ªÆ LI·ªÜU T·ª™ LOCALSTORAGE (CH√åA KH√ìA QUAN TR·ªåNG)
            const orders = JSON.parse(localStorage.getItem('allOrders')) || [];
            const tbody = document.getElementById('order-table-body');
            const emptyMsg = document.getElementById('empty-order-msg');
            
            tbody.innerHTML = '';

            if (orders.length === 0) {
                emptyMsg.classList.remove('d-none');
                return;
            } else {
                emptyMsg.classList.add('d-none');
            }

            orders.forEach((order, index) => {
                // T·∫°o t√≥m t·∫Øt m√≥n h√†ng
                let summary = order.items.map(i => `${i.name} (x${i.quantity})`).join('<br>');
                
                // Class tr·∫°ng th√°i
                let badgeClass = '';
                let statusText = '';
                if(order.status === 'pending') { badgeClass = 'status-pending'; statusText = '‚è≥ Ch·ªù x·ª≠ l√Ω'; }
                else if(order.status === 'shipping') { badgeClass = 'status-shipping'; statusText = 'üöö ƒêang giao'; }
                else if(order.status === 'done') { badgeClass = 'status-done'; statusText = '‚úÖ Ho√†n th√†nh'; }
                else { badgeClass = 'status-cancel'; statusText = '‚ùå ƒê√£ h·ªßy'; }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="fw-bold text-primary">#${order.id}</td>
                    <td>
                        <div class="fw-bold">${order.customer}</div>
                        <small class="text-muted">${order.phone}</small>
                    </td>
                    <td><small>${summary}</small></td>
                    <td class="text-danger fw-bold">${Number(order.total).toLocaleString()}ƒë</td>
                    <td><span class="${badgeClass}">${statusText}</span></td>
                    <td>
                        <div class="d-flex gap-1">
                            <button class="btn btn-sm btn-primary" onclick="updateStatus(${index}, 'shipping')" title="Giao h√†ng"><i class="fas fa-truck"></i></button>
                            <button class="btn btn-sm btn-success" onclick="updateStatus(${index}, 'done')" title="Ho√†n th√†nh"><i class="fas fa-check"></i></button>
                            <button class="btn btn-sm btn-secondary" onclick="updateStatus(${index}, 'cancel')" title="H·ªßy"><i class="fas fa-times"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // C·∫≠p nh·∫≠t th·ªëng k√™
            updateDashboardStats(orders);
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n
        function updateStatus(index, newStatus) {
            let orders = JSON.parse(localStorage.getItem('allOrders')) || [];
            orders[index].status = newStatus;
            localStorage.setItem('allOrders', JSON.stringify(orders));
            loadOrders(); // V·∫Ω l·∫°i b·∫£ng
            loadDashboard(); // C·∫≠p nh·∫≠t th·ªëng k√™
        }

        function clearOrders() {
            if(confirm("X√≥a s·∫°ch l·ªãch s·ª≠ ƒë∆°n h√†ng?")) {
                localStorage.removeItem('allOrders');
                loadOrders();
                loadDashboard();
            }
        }

        // 4. DASHBOARD & TH·ªêNG K√ä
        function loadDashboard() {
            const orders = JSON.parse(localStorage.getItem('allOrders')) || [];
            const products = JSON.parse(localStorage.getItem('adminProducts')) || [];
            
            // T√≠nh t·ªïng doanh thu (ch·ªâ t√≠nh ƒë∆°n ho√†n th√†nh)
            const revenue = orders
                .filter(o => o.status === 'done')
                .reduce((sum, o) => sum + o.total, 0);

            document.getElementById('stat-revenue').innerText = revenue.toLocaleString() + 'ƒë';
            document.getElementById('stat-orders').innerText = orders.length;
            document.getElementById('stat-products').innerText = products.length;

            // V·∫Ω b·∫£ng ƒë∆°n h√†ng m·ªõi nh·∫•t (L·∫•y 5 ƒë∆°n ƒë·∫ßu)
            const recentBody = document.getElementById('recent-orders-body');
            recentBody.innerHTML = '';
            orders.slice(0, 5).forEach(o => {
                let badgeClass = o.status === 'done' ? 'bg-success' : (o.status === 'pending' ? 'bg-warning text-dark' : 'bg-secondary');
                let statusText = o.status === 'done' ? 'Ho√†n th√†nh' : (o.status === 'pending' ? 'Ch·ªù x·ª≠ l√Ω' : o.status);
                
                recentBody.innerHTML += `
                    <tr>
                        <td>#${o.id}</td>
                        <td>${o.customer}</td>
                        <td class="fw-bold">${Number(o.total).toLocaleString()}ƒë</td>
                        <td><span class="badge ${badgeClass}">${statusText}</span></td>
                    </tr>
                `;
            });
        }

        function updateDashboardStats(orders) {
            // H√†m ph·ª• tr·ª£ update s·ªë li·ªáu khi ƒëang ·ªü tab Orders
            const products = JSON.parse(localStorage.getItem('adminProducts')) || [];
            document.getElementById('stat-orders').innerText = orders.length;
            document.getElementById('stat-products').innerText = products.length;
        }

        function resetSystem() {
            if(confirm("C·∫£nh b√°o: H√†nh ƒë·ªông n√†y s·∫Ω x√≥a s·∫°ch S·∫£n ph·∫©m v√† ƒê∆°n h√†ng v·ªÅ m·∫∑c ƒë·ªãnh. Ti·∫øp t·ª•c?")) {
                localStorage.clear();
                location.reload();
            }
        }

        // T·ª± ƒë·ªông t·∫£i ƒë∆°n h√†ng khi v√†o tab Order
        // (ƒê√£ x·ª≠ l√Ω trong h√†m switchTab kh√¥ng c·∫ßn n·ªØa, ho·∫∑c g·ªçi tr·ª±c ti·∫øp ·ªü onclick)
    </script>
</body>
</html>