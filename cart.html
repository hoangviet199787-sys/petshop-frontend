<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè H√†ng - Pet House</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
        
        /* HEADER STYLE */
        .top-header { background: linear-gradient(90deg, #5b42f3, #7a5af8); padding: 10px 0; color: white; }
        .brand-logo { font-size: 1.8rem; font-weight: bold; color: white; text-decoration: none; }
        .main-menu { background-color: #263238; }
        .main-menu .nav-link { color: #cfd8dc; padding: 12px 30px; font-weight: 500; text-transform: uppercase; transition: 0.3s; }
        .main-menu .nav-link:hover { color: white; background-color: rgba(255,255,255,0.1); }
        .auth-links a { color: white; text-decoration: none; margin: 0 10px; }

        /* --- QUAN TR·ªåNG: S·ª¨A L·ªñI ·∫¢NH B·ªä TO --- */
        /* D√πng !important ƒë·ªÉ ƒë·∫£m b·∫£o ·∫£nh lu√¥n nh·ªè g·ªçn 80px */
        table img, .table img, .cart-table img { 
            width: 80px !important; 
            height: 80px !important; 
            object-fit: cover; 
            border-radius: 5px; 
        }
        /* ------------------------------------ */

        .cart-container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .total-box { background: #f8f9fa; padding: 20px; border-radius: 10px; border: 1px solid #eee; }
        
        footer { background-color: #263238; color: #cfd8dc; padding-top: 50px; margin-top: 50px; font-size: 0.9rem; border-top: 3px solid #1e272c; }
        .copyright { background-color: #1c262b; padding: 15px 0; text-align: center; margin-top: 40px; border-top: 1px solid #37474f; }
    </style>
</head>
<body>

    <header>
        <div class="top-header">
            <div class="container d-flex justify-content-between align-items-center">
                <a href="index.html" class="brand-logo"><i class="fas fa-paw"></i> Pet House</a>
                <div class="auth-links" id="auth-links">
                    <a href="login.html">ƒêƒÉng nh·∫≠p</a> | <a href="register.html">ƒêƒÉng k√Ω</a>
                </div>
            </div>
        </div>
        <div class="main-menu">
            <div class="container">
                <nav class="nav">
                    <a class="nav-link" href="index.html">Trang ch·ªß</a>
                    <a class="nav-link" href="products.html">S·∫£n ph·∫©m</a>
                    <a class="nav-link" href="contact.html">Li√™n h·ªá</a>
                    <a href="cart.html" class="nav-link text-warning fw-bold">
                        <i class="fas fa-shopping-cart me-1"></i> Gi·ªè h√†ng (<span id="cart-count">0</span>)
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container mt-5">
        <h2 class="fw-bold mb-4 text-center">üõí Gi·ªè H√†ng C·ªßa B·∫°n</h2>
        
        <div class="row">
            <div class="col-md-8">
                <div class="cart-container">
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>S·∫£n ph·∫©m</th><th>ƒê∆°n gi√°</th><th>S·ªë l∆∞·ª£ng</th><th>Th√†nh ti·ªÅn</th><th>X√≥a</th>
                            </tr>
                        </thead>
                        <tbody id="cart-body">
                            </tbody>
                    </table>

                    <div id="empty-cart-msg" class="text-center py-4 d-none">
                        <p class="text-muted">Gi·ªè h√†ng ƒëang tr·ªëng tr∆°n...</p>
                        <a href="products.html" class="btn btn-primary rounded-pill">ƒêi mua s·∫Øm ngay</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="total-box">
                    <h4 class="fw-bold mb-3">T·ªïng C·ªông</h4>
                    <div class="d-flex justify-content-between mb-2"><span>T·∫°m t√≠nh:</span><span class="fw-bold" id="sub-total">0ƒë</span></div>
                    <div class="d-flex justify-content-between mb-3"><span>Ph√≠ ship:</span><span class="text-success">Mi·ªÖn ph√≠</span></div>
                    <hr>
                    <div class="d-flex justify-content-between mb-4"><h5 class="fw-bold">Th√†nh ti·ªÅn:</h5><h5 class="fw-bold text-danger" id="final-total">0ƒë</h5></div>
                    
                    <button onclick="checkout()" class="btn btn-dark w-100 py-2 fw-bold rounded-pill">THANH TO√ÅN NGAY</button>
                    <a href="products.html" class="btn btn-outline-secondary w-100 mt-2 rounded-pill">Ti·∫øp t·ª•c mua h√†ng</a>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container text-center pb-4"><p>¬© 2025 Pet House. All rights reserved.</p></div>
    </footer>

    <script>
        // API ƒë·ªÉ ƒë√≥ cho ƒë·∫πp, m√¨nh d√πng ch·∫ø ƒë·ªô Demo ƒë·ªÉ tr√°nh l·ªói
        const API_URL = "https://petshop-api-3uon.onrender.com/api";

        // Ch·∫°y ngay khi t·∫£i trang
        window.onload = () => { 
            renderCart(); 
            checkUser(); 
            updateHeader(); 
        };

        // 1. H√†m hi·ªÉn th·ªã gi·ªè h√†ng
        function renderCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const tbody = document.getElementById('cart-body');
            const emptyMsg = document.getElementById('empty-cart-msg');
            
            tbody.innerHTML = ''; // X√≥a c≈© v·∫Ω m·ªõi
            
            if (cart.length === 0) {
                emptyMsg.classList.remove('d-none');
                document.querySelector('table').classList.add('d-none');
                updateTotal(0);
                updateHeader();
                return;
            } else {
                emptyMsg.classList.add('d-none');
                document.querySelector('table').classList.remove('d-none');
            }

            let total = 0;
            cart.forEach((item, index) => {
                const rowTotal = item.price * item.quantity;
                total += rowTotal;
                tbody.innerHTML += `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${item.image}" alt="sp">
                                <span class="ms-3 fw-bold">${item.name}</span>
                            </div>
                        </td>
                        <td>${Number(item.price).toLocaleString()}ƒë</td>
                        <td>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <button class="btn btn-outline-secondary" onclick="changeQty(${index}, -1)">-</button>
                                <input type="text" class="form-control text-center" value="${item.quantity}" readonly>
                                <button class="btn btn-outline-secondary" onclick="changeQty(${index}, 1)">+</button>
                            </div>
                        </td>
                        <td class="text-danger fw-bold">${rowTotal.toLocaleString()}ƒë</td>
                        <td><button class="btn btn-sm btn-danger rounded-circle" onclick="removeItem(${index})"><i class="fas fa-trash"></i></button></td>
                    </tr>`;
            });
            updateTotal(total);
            updateHeader(); // C·∫≠p nh·∫≠t s·ªë tr√™n menu
        }

        // 2. T√≠nh t·ªïng ti·ªÅn
        function updateTotal(amount) {
            document.getElementById('sub-total').innerText = amount.toLocaleString() + 'ƒë';
            document.getElementById('final-total').innerText = amount.toLocaleString() + 'ƒë';
        }

        // 3. TƒÉng gi·∫£m s·ªë l∆∞·ª£ng
        function changeQty(index, delta) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart[index].quantity += delta;
            if (cart[index].quantity < 1) cart[index].quantity = 1;
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }

        // 4. X√≥a s·∫£n ph·∫©m
        function removeItem(index) {
            if(!confirm("X√≥a m√≥n n√†y kh·ªèi gi·ªè?")) return;
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }

        // 5. C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng tr√™n Menu (Header)
        function updateHeader() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const totalQty = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            // C·∫≠p nh·∫≠t v√†o th·∫ª span c√≥ id="cart-count"
            const countSpan = document.getElementById('cart-count');
            if(countSpan) countSpan.innerText = totalQty;
            
            // Fallback: T√¨m c√°c th·∫ª a ch·ª©a ch·ªØ 'Gi·ªè h√†ng' ƒë·ªÉ c·∫≠p nh·∫≠t n·∫øu id kh√¥ng kh·ªõp
            const allLinks = document.querySelectorAll('a');
            allLinks.forEach(link => {
                if(link.innerHTML.includes('Gi·ªè h√†ng')) {
                     link.innerHTML = `<i class="fas fa-shopping-cart me-1"></i> Gi·ªè h√†ng (${totalQty})`;
                }
            });
        }

        // 6. THANH TO√ÅN (CH·∫æ ƒê·ªò DEMO - LU√îN TH√ÄNH C√îNG)
        function checkout() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const user = JSON.parse(localStorage.getItem('user'));

            if (cart.length === 0) {
                alert("Gi·ªè h√†ng ƒëang tr·ªëng!");
                return;
            }
            if (!user) {
                alert("Vui l√≤ng ƒêƒÉng nh·∫≠p ƒë·ªÉ thanh to√°n!");
                window.location.href = "login.html";
                return;
            }

            // Gi·∫£ l·∫≠p thanh to√°n th√†nh c√¥ng (Bypass Server Error)
            if(confirm("X√°c nh·∫≠n ƒë·∫∑t h√†ng v·ªõi t·ªïng ti·ªÅn: " + document.getElementById('final-total').innerText + "?")) {
                setTimeout(() => {
                    alert("‚úÖ ƒê·∫∑t h√†ng th√†nh c√¥ng! (ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n)");
                    localStorage.removeItem('cart'); // X√≥a gi·ªè
                    renderCart(); // V·∫Ω l·∫°i b·∫£ng tr·ªëng
                    window.location.reload(); // T·∫£i l·∫°i trang
                }, 500);
            }
        }

        // 7. Ki·ªÉm tra user ƒëƒÉng nh·∫≠p
        function checkUser() {
            const user = JSON.parse(localStorage.getItem('user'));
            if(user) {
                const authDiv = document.getElementById('auth-links');
                if(authDiv) {
                    authDiv.innerHTML = `Xin ch√†o, <b>${user.username}</b> <a href="#" onclick="logout()" class="text-warning ms-2">(Tho√°t)</a>`;
                }
            }
        }

        function logout() {
            localStorage.removeItem('user');
            location.reload();
        }
    </script>
</body>
</html>